pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
function _init()
	p=make_object(30,30,1,5,7,1)
	dog=make_object(150,150,11)
	initcrops()
end

function _update()
	player_movement()
 follow()
 updatecrops()
 plant_seeds()
end

function _draw()
	update_camera()
	cls(3)
	draw_map()
	draw_objects()
	drawcrops()
	print(p.sprite)
	print(p.sdown)
	print(p.sup)
	print(p.snumber)
end

-->8
--player

local framedelay = 15

function player_movement()
	dx=p.x
	dy=p.y
	if (btn(➡️)) then
	 p.x+=1
	 animation_x()
	 p.snumber=p.sx
	elseif (btn(⬅️)) then
		p.x-=1
		animation_x()
		p.snumber=p.sx
	elseif (btn(⬇️)) then
		p.y+=1
		animation_down()
		p.snumber=p.sdown
	elseif (btn(⬆️)) then
		p.y-=1
	 animation_up()
	 p.snumber=p.sup
	else
	p.snumber=p.sprite
	end
	if  collide(p) then
		p.x=dx
		p.y=dy
	end
end

function plant_seeds()
 local plantx=(p.x+4)/8
 local planty=(p.y+7)/8
 
 if btnp(❎) then
	 if fget(mget(plantx,planty),1) then
		 mset(plantx,planty,13)
		 add (seeds,{
	   sx=flr(plantx),
	   sy=flr(planty),
	   tig=0 --time in ground
	   })
	 elseif fget(mget(plantx,planty),2) then
	 	--collect carrot
	 	mset(plantx,planty,0)
	 	for s in all(seeds) do
	 		if s.sx==flr(plantx) and s.sy==flr(planty) then
	 			del(seeds,s)
	 		end
	 	end--for
	 end
 end
end

function animation_down()
 
	if framedelay >0 then
		framedelay-=1
		return
 end
 
 framedelay = 15
 
	if p.sdown<4 then 
		p.sdown+=1
	else
		p.sdown=1
	end
end

function animation_x()
	
	if framedelay >0 then
		framedelay-=1
		return
 end
 
 framedelay = 15
 
	if p.sx<6 then 
		p.sx+=1
	else
		p.sx=5
	end
end

function animation_up()
	if framedelay >0 then
		framedelay-=1
		return
 end
 
 framedelay = 15
 
	if p.sup<10 then 
		p.sup+=1
	else
		p.sup=7
	end
end

function draw()
	
end
-->8
--make_objects

objects={}

function make_object(x,y,sprite,sx,sup,sdown)
	local object = {}
	object.x = x
	object.y = y
	object.snumber = sprite
	object.sprite = sprite
	object.sx = sx
	object.sup = sup
	object.sdown = sdown
	add(objects,object)
	return object
end

function draw_objects()
	spr(p.snumber,p.x,p.y)
	spr(dog.sprite,dog.x,dog.y)
end
-->8
--dog

function follow()

	local speed = 0.7 --deplacement pixel/frame
	-- seuil de distance pour s'arreter avant d'atteindre le joueur
 distancethreshold = 9 

	if abs(dog.x - p.x) > distancethreshold then
		if dog.x < p.x then
		    dog.x += speed
		elseif dog.x > p.x then
		    dog.x -= speed
		end
  end

  if abs(dog.y - p.y) > distancethreshold then
   if dog.y < p.y then
       dog.y += speed
   elseif dog.y > p.y then
       dog.y -= speed
   end
  end
 end

-->8
--map

function draw_map()
	map(0,0,0,0,128,64)
end

--check_flag
function check_flag(flag,x,y)
	local sprite = mget(x,y)
	return fget(sprite,flag)
end

-- collide
function collide(p)

local x1 = p.x/8
local y1 = p.y/8
local x2 = (p.x+7)/8
local y2 = (p.y+7)/8

local a=fget(mget(x1,y1),0)
local b=fget(mget(x1,y2),0)
local c=fget(mget(x2,y2),0)
local d=fget(mget(x2,y1),0)

	if a or b or c or d then
	 return true
	else 
	 return false
	end
end

--camera

function update_camera()
	camx=flr(p.x/128)*16
	camy=flr(p.y/128)*16
	camera(camx*8,camy*8)
end
-->8
--crops

function initcrops()
	croptimer=300
	seeds={ }
end

function updatecrops()
	for s in all(seeds) do
    s.tig+=1
    
   if s.tig>300  then
    mset(s.sx,s.sy,15)
   end
   
 end
end

function drawcrops()

end
__gfx__
0000000000999990000000000099999000000000000000000009999000000000009999000000000000999900009fff0000000000044444400444444004444440
000000000999ff99009999900999ff990099999000099990009999f0009999000999999000999900099999900471f170009fff004424444444244494444b4b44
00700700999cfc990999ff99999cfc990999ff99009999f000999fc00999999099999999099999909999999944fff4550471f17044444244444942444442b444
0007700099fffff9999cfc9999fffff9999cfc9900999fc000999ff0999999909999999999999990999999994499444444fff455444444444444444444499944
000770000926262999fffff90926262999fffff900999ff00099926099999999099999999999999909999999440880e044994444444244444442444444299944
007007000912111909262629091211190926262900999260000993200999999900999990099999990099999000fffa00440880e0444444444944494444299924
0000000000f111f009f211f900f111f009f211f9000993200003f30000f999f000f999f000f999f000f999f00ffff0000ffffa00424444244244442444422244
00000000000ddd00000ddd00000ddd00000ddd00000dfd00000ddd000009dd00000d9d00000dd900000d9d00f09f6600f09ff900044444400444444004444440
0000000000000000000000000000000000011000000000000000000000144100cccccccccccccccccccccccc3333333333333333333333330000000000000000
0000000000000000000000000005550000133100007000000000000000144100cccccccccccccccccccccccc3333333333333333333333330000000000000000
0000000000b0000000000000005666500133b3100797000000000000015ff510cccccccccccccccccccccccc3333333333333333333333330000000000000000
00000000b00b00b00006660001d666100133b310007303000055500005ffff50ccccccdddddddddddccccccc3333335555555555553333330000000000000000
000000000b0b0b000066666001d66610018bb3100000300005fff500014ff410cccccd66666666666dcccccc3333356666666666665333330000000000000000
000000000b000b000666666015dd66d11388bb31000033700124410000144100ccccd6555555555556dccccc333356dddddddddddd6533330000000000000000
000000000000000006666650155dddd1133bb481003337970122440000144100cccd653333333333356dcccc33356dccccccccccccd653330000000000000000
000000000000000005555500155555511333b841000000700000000000144100ccd65333333333333356dccc3356dccccccccccccccd65330000000000000000
000000000000000000000000000000001333b331000000000005500000144100ccd653333333333333356dcc3356dccccccccccccccd65330000000000000000
000000000000000000000000000000001384b33100c00000005ff50000144100ccd653333333333333356dcc3356dccccccccccccccd65330000000000000000
000000000000000000000000000000000148b3310c9c000015ffff50005ff500ccd653333333333333356dcc3356dccccccccccccccd65330000000000000000
000000000000000000000000000000001333b33100c00000444ff41005ffff50ccd653333333333333356dcc3356dccccccccccccccd65330000000000000000
00000000000000000000000000000000133113100000000044444410015ff510ccd653333333333333356dcc3356dccccccccccccccd65330000000000000000
0000000000000000000000000000000013144131000000c01114410001455410ccd653333333333333356dcc3356dccccccccccccccd65330000000000000000
000000000000000000000000000000001314413100000c9c0014410000144100ccd653333333333333356dcc3356dccccccccccccccd65330000000000000000
0000000000000000000000000000000001144110000000c00014410000144100ccd653333333333333356dcc3356dccccccccccccccd65330000000000000000
0000000000000000000000000000000000000000000000000005500000055000ccd653333333333333356dcc3356dccccccccccccccd65330000000000000000
000000000000000000000000000000000000000000000000005ff500005ff500cccd6533333333333356dccc33356dccccccccccccd653330000000000000000
00000000000000000000000000000000000000000000000005ffff5115ffff51ccccd65333333333356dcccc333356dddddddddddd6533330000000000000000
000000000000000000000000000000000000000000000000014ff444444ff444cccccd655555555556dccccc3333356666666666665333330000000000000000
0000000000000000000000000000000000000000000000000144444444444444ccccccd6666666666dcccccc3333335555555555553333330000000000000000
0000000000000000000000000000000000000000000000000014411111144111cccccccddddddddddccccccc3333333333333333333333330000000000000000
0000000000000000000000000000000000000000000000000014410000144100cccccccccccccccccccccccc3333333333333333333333330000000000000000
0000000000000000000000000000000000000000000000000014410000144100cccccccccccccccccccccccc3333333333333333333333330000000000000000
00000000000440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000044444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000044444994444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00004449494994949444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004494a494a94949494400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0049494949499494a494940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04494949494994949494944000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
49494a494949a4a49494949400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4949494a494994949494949400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
494a49494949949494a4949400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
49494949494994949494949400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
49494949494994949494a4a400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4a494949494aa4949494949400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
494949494a4114a49494949400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
494a4949411111149494949400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4949494a11155111a494949400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
49494941155665511494949400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
49494a115666666551a4949400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
49494115666666666514949400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
494a1156666666666651a49400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
49411566666666666665149400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4a11566666666555666651a400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
41156644466664444446651400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11566414146665555555665100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
15664114114666666666665100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
15664114114666111166665100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
15664444444666111166665100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
15664114114661111115665100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
15664114114651911116665100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
15666444446661111116665100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01666666666661111116661000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00166666666664444446610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0200000000000000000000000000000400020101010200010101010101010000000000000102010100000101010100000000000000000101010101010101000001010100000000000000000000000000010101000000000000000000000000000101010000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1700150014000014000000140014001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2700000024121424141211241424001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3711000000002400240000002400001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1700001500000000000000001200001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2700000000001100150000000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3711001200250000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b1c1c1c1c1c1c1d000000000013001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2b2c2c2c2c2c2c2d000000150000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2b2c2c2c2c2c2c2d110000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b19191a2c2c2c2d000000000011001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1100152b2c2c2c2d000013000000251000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002b2c2c2c2d250000000015001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1200112b2c2c2c2d000000000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1100003b3c3c1a2d001500000013131000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1500001100153b3d000000001100001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1500002500000000000000000000000000000000000000004041420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000011000000000000140000005051520014001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3737373700000013000025000000000000000014241400006061620024142400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1400142700000015000000000000000000000024002400007071720000240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2400243700110000000000001300000000001100000000001100001100000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0014001700000000000000000000002500000000000011001500000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0024002700000000110000001100000000150011000000000000002500120015000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1500143700000000000000000000000000001b1c1d0000001600000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1400241700000000000015000000000000112b2c2d0000001115000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2400002700000013000000000000000000003b3c3d0000000000000011000016000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000143700000000110000000000000000150011250011000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1300241700110000000000000025000000000036373700373726110015000012000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000027000000000000000000000000001300170f0f0f0f0f17000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
15001227000000000000000000000000000000170f0f0f0f0f17150012000015000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
37373737001500000011001200110000000000270f0f0f0f0f27110000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000150000170f0f0f0f0f17000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00010000000000a0500f050170501c0502005023050240502705028050290502a0502a0502a05029050280502705026050260502405022050200501c0501c0500000000000000000000000000000000000000000
